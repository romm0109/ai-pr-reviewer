# Simple GitLab CI/CD Configuration for AI PR Reviewer
# 
# Just copy this to .gitlab-ci.yml in your repository!
#
# Required: Set these variables in GitLab Settings → CI/CD → Variables:
# - GITLAB_TOKEN: GitLab access token with 'api' scope
# - OPENAI_API_KEY: Your OpenAI API key

stages:
  - review

ai-code-review:
  stage: review
  # Use the pre-built Docker image (replace with your registry after building)
  # For now, this assumes you've built and pushed the image to a registry
  image: ${CI_REGISTRY_IMAGE}/ai-pr-reviewer:latest
  
  # Only run on merge requests
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
  
  variables:
    PLATFORM: "gitlab"
    # Optional: Customize these if needed
    OPENAI_LIGHT_MODEL: "gpt-3.5-turbo"
    OPENAI_HEAVY_MODEL: "gpt-4"
  
  # That's it! The container handles everything
  script:
    - echo "Running AI code review..."

# Optional: Build and publish the Docker image
# Uncomment this if you want to build the image in your own registry
#
# build-reviewer-image:
#   stage: build
#   image: docker:24
#   services:
#     - docker:24-dind
#   before_script:
#     - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
#   script:
#     - docker build -t ${CI_REGISTRY_IMAGE}/ai-pr-reviewer:latest .
#     - docker push ${CI_REGISTRY_IMAGE}/ai-pr-reviewer:latest
#   only:
#     - main
